--Productos con stock superior al promedio de su categoria
SELECT
    p.nombre, p.stock
FROM
    productos p
JOIN
    (
        SELECT
            categoria_id,
            AVG(stock) AS promedio_stock
        FROM
            productos
        GROUP BY
            categoria_id
    ) AS promedios ON p.categoria_id = promedios.categoria_id
WHERE
    p.stock > promedios.promedio_stock;
